BootStrap: library
From: ubuntu:20.04

%files
    /mnt/mnemo5/tao/conda_envs/sequence_tools_environment.yml  /home/conda_envs/sequence_tools_environment.yml 
    /mnt/mnemo5/tao/conda_envs/py37_pydca_environment.yml      /home/conda_envs/py37_pydca_environment.yml

%post
    apt-get update && apt-get -y upgrade
    apt-get -y install \
    build-essential \
    wget \
    less 
    
    # seem this is singularity comment grammer
    # problem here the # seem not the total the comment grammar, other section for example in %files

    
    # Installing miniconda, https://stackoverflow.com/questions/54678805/containerize-a-conda-environment-in-a-singularity-container,https://docs.conda.io/projects/miniconda/en/latest/index.html,
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh #-O ~/miniconda3/miniconda.sh, here need to careful with fodler inside container, this comand install to root "/" folder 
    bash  Miniconda3-latest-Linux-x86_64.sh -b -u -p /home/miniconda3 # this install to /home
    
    
    #/home/miniconda3/bin/conda init bash # initialize your newly-installed Miniconda, but not working , why 
    #source /home/miniconda3/etc/profile.d/conda.sh # this one works https://stackoverflow.com/questions/59877249/activating-a-conda-environment-in-a-singularity-recipe
    #in most shell use, use . instead of source ,https://stackoverflow.com/questions/13702425/source-command-not-found-in-sh-shell
    . /home/miniconda3/etc/profile.d/conda.sh
    
    
    # #install conda enviroment, here if conda is successfull initialised above, could simplly use conda without full path 
    /home/miniconda3/bin/conda env  create  -f /home/conda_envs/sequence_tools_environment.yml
    /home/miniconda3/bin/conda env  create  -f /home/conda_envs/py37_pydca_environment.yml
    
    #List installed environments, here is triky, in building step, this will only output envs created in post section, if enter to generated container and run this, it will aso show envs from host system , and created envs inside container, somehow it also save envs in the host system 
    # but no prblem on envs install inside container has the name :
    # base                  *  /home/miniconda3
    # py37_pydca               /home/miniconda3/envs/py37_pydca
    # sequence_tools           /home/miniconda3/envs/sequence_tools
    #                          /mnt/mnemo5/tao/anaconda3/envs/alphafold2_2_0
    #                          /mnt/mnemo5/tao/anaconda3/envs/sequence_tools
                         
    conda info --envs
    
    
    

%environment
    export LC_ALL=C
    export PATH=$PATH:/home/miniconda3/bin/conda # check this:   /root/.bashrc, this is nomal linux exprot grammer "export PATH="/home/miniconda3/bin/conda:$PATH""
    
    

%runscript
    echo "this section defines actions for the container to take when it is executed. (These commands will therefore not be run at build time.)"

# cd /mnt/mnemo5/tao/PPI_Prediction_byCoevolution/containers
# singularity build --remote --sandbox /mnt/mnemo5/tao/singularity_containers/PPICoe /mnt/mnemo5/tao/PPI_Prediction_byCoevolution/containers/PPICoe.def
# or  singularity build --fakeroot /mnt/mnemo5/tao/singularity_containers/PPICoe.sif /mnt/mnemo5/tao/PPI_Prediction_byCoevolution/containers/PPICoe.def


# enter the container : singularity shell PPICoe.sif

# now i read this file with YAML format, but i'm not sure about its really format 



